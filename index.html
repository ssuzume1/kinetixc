<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kinetix । Global Quality Content Hub</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://wsrv.nl">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --text-dim: #64748b; --border: #e2e8f0; --accent: #facc15; }
        [data-theme="dark"] { --bg: #020617; --card: #0f172a; --text: #f1f5f9; --text-dim: #94a3b8; --border: #1e293b; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; min-height: 100vh; }
        
        /* Navigation */
        nav { position: sticky; top: 0; z-index: 1000; background: var(--card); border-bottom: 1px solid var(--border); padding: 0.7rem 5%; display: flex; justify-content: space-between; align-items: center; gap: 10px; backdrop-filter: blur(10px); }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
        .search-wrap { position: relative; flex: 1; max-width: 500px; }
        .search-wrap input { width: 100%; padding: 0.6rem 1rem 0.6rem 2.5rem; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; }
        .search-wrap i { position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%); color: var(--text-dim); }
        
        .nav-icons { display: flex; gap: 8px; }
        .btn-icon { width: 38px; height: 38px; border-radius: 10px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; background: var(--card); color: var(--text); }

        /* Dashboard UI */
        .container { max-width: 1200px; margin: 1.5rem auto; padding: 0 1rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; display: none; } /* Hidden for users */
        .stat-card { background: var(--card); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border); text-align: center; }
        .stat-card h4 { color: var(--text-dim); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 5px; }
        .stat-card p { font-size: 1.8rem; font-weight: 800; color: var(--primary); }

        /* Content Grid */
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .section-title { font-size: 1.4rem; font-weight: 800; display: flex; align-items: center; gap: 10px; }
        .section-title::before { content: ''; width: 4px; height: 24px; background: var(--primary); border-radius: 10px; }
        
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1.5rem; }
        .m-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; position: relative; transition: 0.3s; display: flex; flex-direction: column; }
        .m-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        
        .m-poster-wrap { position: relative; width: 100%; aspect-ratio: 2/3; background: #1e293b; }
        .m-poster { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.5s; }
        .m-poster.loaded { opacity: 1; }
        
        .tag-quality { position: absolute; top: 10px; left: 10px; background: var(--primary); color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; z-index: 5; }
        .m-details { padding: 1.2rem; flex-grow: 1; display: flex; flex-direction: column; }
        .m-info { display: flex; justify-content: space-between; margin-bottom: 1rem; }
        .m-title { font-weight: 700; font-size: 1rem; line-height: 1.3; }
        .tag-rating { background: var(--accent); color: #713f12; padding: 2px 6px; border-radius: 6px; font-weight: 800; font-size: 0.75rem; }
        .btn-dl { display: block; width: 100%; text-align: center; background: var(--primary); color: white; padding: 0.8rem; border-radius: 10px; text-decoration: none; font-weight: 700; margin-top: auto; }

        /* Admin Dashboard Styles */
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; padding: 1rem; overflow-y: auto; backdrop-filter: blur(5px); }
        .dashboard-box { background: var(--card); max-width: 800px; margin: 2rem auto; padding: 2rem; border-radius: 24px; position: relative; border: 1px solid var(--border); }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 700px) { .dashboard-grid { grid-template-columns: 1fr; } }

        .admin-section { background: var(--bg); padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border); }
        .admin-section h3 { margin-bottom: 1rem; font-size: 1.1rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        input { width: 100%; padding: 0.8rem; margin-bottom: 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--card); color: var(--text); outline: none; }
        .btn-pub { background: var(--primary); color: white; border: none; padding: 0.8rem; border-radius: 10px; font-weight: 700; width: 100%; cursor: pointer; }
        .btn-del { position: absolute; top: 10px; right: 10px; background: #ef4444; color: white; border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: none; }

        .footer-req { margin: 4rem 0; text-align: center; }
        .req-link { display: inline-block; background: var(--text); color: var(--bg); padding: 0.8rem 2.5rem; border-radius: 50px; text-decoration: none; font-weight: 700; transition: 0.3s; }
        
        @media (max-width: 600px) { .movie-grid { grid-template-columns: 1fr 1fr; gap: 0.8rem; } }
    </style>
</head>
<body data-theme="dark">

    <nav>
        <div class="logo">Kinetix</div>
        <div class="search-wrap"><i class="fa-solid fa-search"></i><input type="text" id="qInput" placeholder="Search library..." onkeyup="doSearch()"></div>
        <div class="nav-icons">
            <div class="btn-icon" onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke"></i></div>
            <div class="btn-icon" onclick="openAdmin()"><i class="fa-solid fa-gauge-high"></i></div>
        </div>
    </nav>

    <div class="container">
        <div id="adminStats" class="stats-grid">
            <div class="stat-card"><h4>Total Titles</h4><p id="statTotal">0</p></div>
            <div class="stat-card"><h4>Database Status</h4><p style="font-size:1rem; color:#10b981">● GLOBAL LIVE</p></div>
        </div>

        <div class="section-header">
            <h2 class="section-title">Explore Library</h2>
        </div>
        
        <div class="movie-grid" id="mGrid"></div>

        <div class="footer-req">
            <a href="#" id="reqURL" target="_blank" class="req-link"><i class="fa-solid fa-paper-plane"></i> Request Content</a>
        </div>
    </div>

    <div id="adminDashboard" class="overlay">
        <div class="dashboard-box">
            <span style="position:absolute; right:20px; top:20px; cursor:pointer; font-size:1.5rem" onclick="closeM()">&times;</span>
            <h2 style="margin-bottom:2rem"><i class="fa-solid fa-shield-halved"></i> Master Dashboard</h2>
            
            <div class="dashboard-grid">
                <div class="admin-section">
                    <h3><i class="fa-solid fa-plus-circle"></i> Add New Content</h3>
                    <input type="text" id="imdbID" placeholder="IMDb ID (tt1234567)">
                    <input type="text" id="manualPoster" placeholder="Manual Poster URL (Optional)">
                    <input type="text" id="qlt" placeholder="Quality (e.g. 1080p Bluray)">
                    <input type="text" id="aud" placeholder="Audio (e.g. Dual Audio)">
                    <input type="text" id="dlLink" placeholder="Download Link">
                    <button class="btn-pub" id="addBtn" onclick="saveMovie()">Publish to Global</button>
                </div>

                <div class="admin-section">
                    <h3><i class="fa-solid fa-gear"></i> Global Settings</h3>
                    <label style="font-size:0.75rem; color:var(--text-dim)">Permanent Request Link:</label>
                    <input type="text" id="rLink" placeholder="Set your permanent request URL">
                    <button class="btn-pub" style="background:#475569" onclick="updateSettings()">Update Settings</button>
                    
                    <div style="margin-top:2rem">
                        <button class="btn-pub" style="background:#ef4444" onclick="logout()">Logout & Lock</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="overlay">
        <div class="m-box" style="background:var(--card); max-width:350px; margin:10% auto; padding:2rem; border-radius:20px; text-align:center">
            <h3>Admin Login</h3><br>
            <input type="text" id="u" placeholder="User">
            <input type="password" id="p" placeholder="Pass">
            <button class="btn-pub" onclick="doLogin()">Unlock Dashboard</button>
        </div>
    </div>

    <script>
        // 1. CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyBWMgvC7lJKwc8D9dbm3Q1ozMCFfmrdxDo",
            authDomain: "kinetix-52add.firebaseapp.com",
            projectId: "kinetix-52add",
            storageBucket: "kinetix-52add.firebasestorage.app",
            messagingSenderId: "151982942702",
            appId: "1:151982942702:web:00c4b2a31853903e8886ff",
            measurementId: "G-PMPQ8TL07B"
        };
        const OMDB_KEY = '38785e98';

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. DATA SYNC
        function sync() {
            // Real-time Movie Feed
            db.collection("movies").orderBy("createdAt", "desc").onSnapshot((snap) => {
                const movies = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                render(movies);
                document.getElementById('statTotal').innerText = snap.size;
            });

            // Permanent Settings Sync
            db.collection("settings").doc("global").onSnapshot(doc => {
                if(doc.exists()) {
                    const url = doc.data().requestUrl;
                    document.getElementById('reqURL').href = url;
                    document.getElementById('rLink').value = url;
                }
            });

            // Check Admin Status
            if(sessionStorage.getItem('kx_admin') === 'true') {
                document.getElementById('adminStats').style.display = 'grid';
            }
        }

        function render(data) {
            const grid = document.getElementById('mGrid');
            const isAdmin = sessionStorage.getItem('kx_admin') === 'true';
            
            grid.innerHTML = data.map((m) => {
                const fastPoster = `https://wsrv.nl/?url=${encodeURIComponent(m.poster)}&w=350&output=webp`;
                return `
                <div class="m-card">
                    ${isAdmin ? `<button class="btn-del" style="display:block" onclick="remove('${m.id}')"><i class="fa-solid fa-trash"></i></button>` : ''}
                    <div class="m-poster-wrap">
                        <span class="tag-quality">${m.quality}</span>
                        <img class="m-poster" src="${fastPoster}" alt="Poster" onload="this.classList.add('loaded')" loading="lazy">
                    </div>
                    <div class="m-details">
                        <div class="m-info">
                            <div class="m-title">${m.title} <span style="font-weight:400; color:var(--text-dim)">(${m.year})</span></div>
                            <span class="tag-rating">★ ${m.rating}</span>
                        </div>
                        <p style="font-size:0.7rem; color:var(--text-dim); margin-bottom:10px">${m.audio}</p>
                        <a href="${m.link}" class="btn-dl" target="_blank">Download</a>
                    </div>
                </div>`;
            }).join('');
        }

        // 3. ADMIN OPERATIONS
        async function saveMovie() {
            const id = document.getElementById('imdbID').value.trim();
            const manual = document.getElementById('manualPoster').value.trim();
            const qlt = document.getElementById('qlt').value || '1080p';
            const aud = document.getElementById('aud').value || 'Multi';
            const lnk = document.getElementById('dlLink').value.trim();

            if (!id || !lnk) return alert('IMDb ID and Link are mandatory!');

            document.getElementById('addBtn').innerText = 'Fetching OMDb Data...';
            try {
                const res = await fetch(`https://www.omdbapi.com/?i=${id}&apikey=${OMDB_KEY}`);
                const d = await res.json();
                if(d.Response === "True") {
                    const finalImg = manual || (d.Poster !== "N/A" ? d.Poster : 'https://via.placeholder.com/400x600');
                    await db.collection("movies").add({
                        title: d.Title, year: d.Year, rating: d.imdbRating,
                        audio: aud, quality: qlt, link: lnk, poster: finalImg,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    document.getElementById('imdbID').value = '';
                    document.getElementById('dlLink').value = '';
                    alert('Movie published globally!');
                } else alert(d.Error);
            } catch (e) { alert('Network error'); }
            document.getElementById('addBtn').innerText = 'Publish to Global';
        }

        async function updateSettings() {
            const newUrl = document.getElementById('rLink').value.trim();
            if(!newUrl) return alert('URL cannot be empty');
            await db.collection("settings").doc("global").set({ requestUrl: newUrl });
            alert('Global Request Link updated permanently!');
        }

        async function remove(id) { if(confirm('Delete permanently?')) await db.collection("movies").doc(id).delete(); }

        // 4. UI LOGIC
        function doLogin() {
            if(document.getElementById('u').value === 'doverx' && document.getElementById('p').value === 'maya123') {
                sessionStorage.setItem('kx_admin', 'true');
                location.reload();
            } else alert('Unauthorized Access');
        }
        function openAdmin() {
            if(sessionStorage.getItem('kx_admin') === 'true') document.getElementById('adminDashboard').style.display='block';
            else document.getElementById('loginModal').style.display='block';
        }
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'); }
        function closeM() { document.querySelectorAll('.overlay').forEach(o => o.style.display='none'); }
        function logout() { sessionStorage.clear(); location.reload(); }
        function doSearch() { 
            const val = document.getElementById('qInput').value.toLowerCase();
            document.querySelectorAll('.m-card').forEach(card => {
                const title = card.querySelector('.m-title').innerText.toLowerCase();
                card.style.display = title.includes(val) ? 'flex' : 'none';
            });
        }
        window.onload = sync;
    </script>
</body>
</html>